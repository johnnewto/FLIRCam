---

title: Example Use of USB stream and Sockets

keywords: fastai
sidebar: home_sidebar

summary: "Example usage  see link  "
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_Example_Sockets_and_USB_Streaming.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Send-and-receive-socket-wih-FLIR-cam">Send and receive socket wih FLIR cam<a class="anchor-link" href="#Send-and-receive-socket-wih-FLIR-cam">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">imutils.video</span> <span class="kn">import</span> <span class="n">FPS</span>
<span class="kn">import</span> <span class="nn">imutils</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">from</span> <span class="nn">FLIRCam.USB_video_stream</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">zmq</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting1&#39;</span><span class="p">)</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
<span class="n">pubsocket</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">PUB</span><span class="p">)</span>
<span class="n">pubsocket</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;tcp://*:5555&quot;</span><span class="p">)</span>

<span class="n">subsocket</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUB</span><span class="p">)</span>
<span class="n">subsocket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;tcp://localhost:5555&quot;</span><span class="p">)</span>
<span class="n">subsocket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUBSCRIBE</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;camera_frame&#39;</span><span class="p">)</span>

<span class="n">width</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">height</span> <span class="o">=</span> <span class="mi">750</span>

<span class="n">fvs</span> <span class="o">=</span> <span class="n">USBVideoStream</span><span class="p">()</span> <span class="c1"># .start()</span>
<span class="n">fvs</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">topic</span> <span class="o">=</span> <span class="s1">&#39;camera_frame&#39;</span>
<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">fvs</span><span class="o">.</span><span class="n">more</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="n">snd_frame</span> <span class="o">=</span> <span class="n">fvs</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>        
        <span class="n">snd_frame</span> <span class="o">=</span> <span class="n">imutils</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">snd_frame</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>   
        
        <span class="n">pubsocket</span><span class="o">.</span><span class="n">send_string</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="n">pubsocket</span><span class="o">.</span><span class="n">send_pyobj</span><span class="p">(</span><span class="n">snd_frame</span><span class="p">)</span>

        <span class="n">rec_topic</span> <span class="o">=</span> <span class="n">subsocket</span><span class="o">.</span><span class="n">recv_string</span><span class="p">()</span>
        <span class="n">rec_frame</span> <span class="o">=</span> <span class="n">subsocket</span><span class="o">.</span><span class="n">recv_pyobj</span><span class="p">()</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">rec_frame</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Received frame number </span><span class="si">{i}</span><span class="s1">, </span><span class="si">{rec_topic}</span><span class="s1">, </span><span class="si">{rec_frame.shape}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Cam1&quot;</span><span class="p">,</span> <span class="n">rec_frame</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span> 
            <span class="k">break</span>  <span class="c1"># esc to quit</span>
    
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;W: interrupt received, stoppingâ€¦&quot;</span><span class="p">)</span>
        <span class="k">break</span>
        
<span class="n">fvs</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>  
<span class="k">del</span> <span class="n">fvs</span>

<span class="n">subsocket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
<span class="n">pubsocket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># clean up</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finished&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Starting1
Library version: 1.27.0.48
Number of cameras detected: 1
Camera acquisition mode set to continuous...
Camera 0 started acquiring images...

Finished
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Send-and-receive-socket-wih-Webcam">Send and receive socket wih Webcam<a class="anchor-link" href="#Send-and-receive-socket-wih-Webcam">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">zmq</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting1&#39;</span><span class="p">)</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
<span class="n">pubsocket</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">PUB</span><span class="p">)</span>
<span class="n">pubsocket</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;tcp://*:5555&quot;</span><span class="p">)</span>

<span class="n">subsocket</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUB</span><span class="p">)</span>
<span class="n">subsocket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;tcp://localhost:5555&quot;</span><span class="p">)</span>
<span class="n">subsocket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUBSCRIBE</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;camera_frame&#39;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting2&#39;</span><span class="p">)</span>
<span class="n">cam</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">topic</span> <span class="o">=</span> <span class="s1">&#39;camera_frame&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting3&#39;</span><span class="p">)</span>
<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">snd_frame</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">pubsocket</span><span class="o">.</span><span class="n">send_string</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="n">pubsocket</span><span class="o">.</span><span class="n">send_pyobj</span><span class="p">(</span><span class="n">snd_frame</span><span class="p">)</span>

        <span class="n">rec_topic</span> <span class="o">=</span> <span class="n">subsocket</span><span class="o">.</span><span class="n">recv_string</span><span class="p">()</span>
        <span class="n">rec_frame</span> <span class="o">=</span> <span class="n">subsocket</span><span class="o">.</span><span class="n">recv_pyobj</span><span class="p">()</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">rec_frame</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Received frame number </span><span class="si">{i}</span><span class="s1">, </span><span class="si">{rec_topic}</span><span class="s1">, </span><span class="si">{rec_frame.shape}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Cam1&quot;</span><span class="p">,</span> <span class="n">rec_frame</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span> 
            <span class="k">break</span>  <span class="c1"># esc to quit</span>
    
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;W: interrupt received, stoppingâ€¦&quot;</span><span class="p">)</span>
        <span class="k">break</span>
        
        
<span class="n">cam</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">subsocket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
<span class="n">pubsocket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># clean up</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finished&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Starting1
Starting2
Starting3
Finished
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Show-FLIR-camera">Show FLIR camera<a class="anchor-link" href="#Show-FLIR-camera">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">show_FLIRcam</span><span class="p">(</span><span class="n">mirror</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">750</span><span class="p">):</span>
    <span class="n">fvs</span> <span class="o">=</span> <span class="n">USBVideoStream</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># while not fvs.more():</span>
        <span class="c1">#     pass</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">fvs</span><span class="o">.</span><span class="n">read_wait</span><span class="p">()</span> 
        <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">imutils</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>     
            <span class="k">if</span> <span class="n">mirror</span><span class="p">:</span> 
                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;FLIR cam&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span> 
                <span class="k">break</span>  <span class="c1"># esc to quit</span>
            
    <span class="n">fvs</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>  
    <span class="k">del</span> <span class="n">fvs</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="n">show_FLIRcam</span><span class="p">(</span><span class="n">mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Library version: 1.27.0.48
Number of cameras detected: 1
Camera acquisition mode set to continuous...
Camera 0 started acquiring images...

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Show-OpenCV-web-camera">Show OpenCV web camera<a class="anchor-link" href="#Show-OpenCV-web-camera">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">show_webcam</span><span class="p">(</span><span class="n">mirror</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">cam</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret_val</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mirror</span><span class="p">:</span> 
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;my webcam&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span> 
            <span class="k">break</span>  <span class="c1"># esc to quit</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
    <span class="n">cam</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="n">show_webcam</span><span class="p">(</span><span class="n">mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
 

