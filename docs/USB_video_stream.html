---

title: FLIR_video_stream

keywords: fastai
sidebar: home_sidebar

summary: "API details."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/51_USB_video_stream.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># def print_device_info(nodemap):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     This function prints the device information of the camera from the transport</span>
<span class="c1">#     layer; please see NodeMapInfo example for more in-depth comments on printing</span>
<span class="c1">#     device information from the nodemap.</span>
<span class="c1"># </span>
<span class="c1">#     - nodemap: Transport layer device nodemap.</span>
<span class="c1">#     - nodemap: INodeMap</span>
<span class="c1">#     - returns: True if successful, False otherwise.</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1"># </span>
<span class="c1">#     print(&#39;*** DEVICE INFORMATION ***\n&#39;)</span>
<span class="c1"># </span>
<span class="c1">#     try:</span>
<span class="c1">#         result = True</span>
<span class="c1">#         node_device_information = PySpin.CCategoryPtr(nodemap.GetNode(&#39;DeviceInformation&#39;))</span>
<span class="c1"># </span>
<span class="c1">#         if PySpin.IsAvailable(node_device_information) and PySpin.IsReadable(node_device_information):</span>
<span class="c1">#             features = node_device_information.GetFeatures()</span>
<span class="c1">#             for feature in features:</span>
<span class="c1">#                 node_feature = PySpin.CValuePtr(feature)</span>
<span class="c1">#                 print(&#39;%s: %s&#39; % (node_feature.GetName(),</span>
<span class="c1">#                                   node_feature.ToString() if PySpin.IsReadable(node_feature) else &#39;Node not readable&#39;))</span>
<span class="c1"># </span>
<span class="c1">#         else:</span>
<span class="c1">#             print(&#39;Device control information not available.&#39;)</span>
<span class="c1"># </span>
<span class="c1">#     except PySpin.SpinnakerException as ex:</span>
<span class="c1">#         print(&#39;Error: %s&#39; % ex)</span>
<span class="c1">#         return False</span>
<span class="c1"># </span>
<span class="c1">#     return result</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># # Retrieve singleton reference to system object</span>
<span class="c1"># system = PySpin.System.GetInstance()</span>
<span class="c1"># </span>
<span class="c1"># # Get current library version</span>
<span class="c1"># version = system.GetLibraryVersion()</span>
<span class="c1"># print(&#39;Library version: %d.%d.%d.%d&#39; % (version.major, version.minor, version.type, version.build))</span>
<span class="c1"># </span>
<span class="c1"># # Retrieve list of cameras from the system</span>
<span class="c1"># cam_list = system.GetCameras()</span>
<span class="c1"># </span>
<span class="c1"># num_cameras = cam_list.GetSize()</span>
<span class="c1"># nodemap_tldevice = cam_list[0].GetTLDeviceNodeMap()</span>
<span class="c1"># </span>
<span class="c1"># print_device_info(nodemap_tldevice)</span>
<span class="c1"># # Release system instance</span>
<span class="c1"># system.ReleaseInstance()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="USBVideoStream" class="doc_header"><code>class</code> <code>USBVideoStream</code><a href="https://github.com/johnnewto/FLIRCam/tree/master/FLIRCam/USB_video_stream.py#L22" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>USBVideoStream</code>(<strong><code>transform</code></strong>=<em><code>None</code></em>, <strong><code>queue_size</code></strong>=<em><code>10</code></em>)</p>
</blockquote>
<p>Create threaded  USB3 video stream for 1 or more FLIR USB3 cameras, with max queue size
Pass optional transform code to alter the image before queueing</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="USBVideoStream.set_cam_mode_continuous" class="doc_header"><code>USBVideoStream.set_cam_mode_continuous</code><a href="https://github.com/johnnewto/FLIRCam/tree/master/FLIRCam/USB_video_stream.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>USBVideoStream.set_cam_mode_continuous</code>(<strong><code>i</code></strong>, <strong><code>cam</code></strong>)</p>
</blockquote>
<p>For all cameras set the acquisition mode set to continuous</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="USBVideoStream.start" class="doc_header"><code>USBVideoStream.start</code><a href="https://github.com/johnnewto/FLIRCam/tree/master/FLIRCam/USB_video_stream.py#L71" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>USBVideoStream.start</code>()</p>
</blockquote>
<p>For all cameras,  Initialise and set camera mode to continuous.
and begin acquisisition</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="USBVideoStream.more" class="doc_header"><code>USBVideoStream.more</code><a href="https://github.com/johnnewto/FLIRCam/tree/master/FLIRCam/USB_video_stream.py#L148" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>USBVideoStream.more</code>()</p>
</blockquote>
<p>Return True if there are still frames in the queue.
If stream is not stopped, try to wait a moment</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="USBVideoStream.read" class="doc_header"><code>USBVideoStream.read</code><a href="https://github.com/johnnewto/FLIRCam/tree/master/FLIRCam/USB_video_stream.py#L130" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>USBVideoStream.read</code>()</p>
</blockquote>
<p>Return next frame in the queue</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="USBVideoStream.read_wait" class="doc_header"><code>USBVideoStream.read_wait</code><a href="https://github.com/johnnewto/FLIRCam/tree/master/FLIRCam/USB_video_stream.py#L134" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>USBVideoStream.read_wait</code>()</p>
</blockquote>
<p>Wait for and return next frame in the queue</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="USBVideoStream.queue_size" class="doc_header"><code>USBVideoStream.queue_size</code><a href="https://github.com/johnnewto/FLIRCam/tree/master/FLIRCam/USB_video_stream.py#L158" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>USBVideoStream.queue_size</code>()</p>
</blockquote>
<p>Return the queue size, ie number of frames</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="USBVideoStream.stop" class="doc_header"><code>USBVideoStream.stop</code><a href="https://github.com/johnnewto/FLIRCam/tree/master/FLIRCam/USB_video_stream.py#L162" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>USBVideoStream.stop</code>()</p>
</blockquote>
<p>indicate that the thread should be stopped</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Show-FLIR-camera">Show FLIR camera<a class="anchor-link" href="#Show-FLIR-camera">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">imutils.video</span> <span class="kn">import</span> <span class="n">FPS</span>
<span class="kn">import</span> <span class="nn">imutils</span>
<span class="k">def</span> <span class="nf">show_FLIRcam</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">750</span><span class="p">):</span>
    <span class="n">fvs</span> <span class="o">=</span> <span class="n">USBVideoStream</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="n">FPS</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">fvs</span><span class="o">.</span><span class="n">read_wait</span><span class="p">()</span> 
        <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">imutils</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>     
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;FLIR cam&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span> 
                <span class="k">break</span>  <span class="c1"># esc to quit</span>
            <span class="n">fps</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>     
            
    <span class="n">fps</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="n">fvs</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>  
    <span class="k">del</span> <span class="n">fvs</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[INFO] approx. FPS: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fps</span><span class="o">.</span><span class="n">fps</span><span class="p">()))</span>
    
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="n">show_FLIRcam</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Library version: 1.27.0.48
Number of cameras detected: 1
Camera acquisition mode set to continuous...
Camera 0 started acquiring images...

[INFO] approx. FPS: 3.38
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test-Example-Usage,-recoding-a-movie">Test Example Usage, recoding a movie<a class="anchor-link" href="#Test-Example-Usage,-recoding-a-movie">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">moviepy.video.io.ffmpeg_writer</span> <span class="kn">import</span> <span class="n">FFMPEG_VideoWriter</span>
<span class="kn">from</span> <span class="nn">imutils.video</span> <span class="kn">import</span> <span class="n">FPS</span>
<span class="kn">import</span> <span class="nn">imutils</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="k">def</span> <span class="nf">record_FLIRcam</span><span class="p">(</span><span class="n">mirror</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">750</span><span class="p">):</span>
    <span class="n">fvs</span> <span class="o">=</span> <span class="n">USBVideoStream</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="n">FPS</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">FFMPEG_VideoWriter</span><span class="p">(</span><span class="s1">&#39;out.mp4&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">),</span> <span class="mf">5.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">video</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">fvs</span><span class="o">.</span><span class="n">read_wait</span><span class="p">()</span> 
            <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
                <span class="n">img</span> <span class="o">=</span> <span class="n">imutils</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>   
                <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Queue Size: {fvs.Q.qsize()}, Camera: </span><span class="si">{frame[&#39;cam&#39;]}</span><span class="s2">, Shape: </span><span class="si">{img.shape}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
                <span class="n">video</span><span class="o">.</span><span class="n">write_frame</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;FLIR cam&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span> 
                    <span class="k">break</span>  <span class="c1"># esc to quit</span>
                <span class="n">fps</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">fps</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="n">fvs</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[INFO] elasped time: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fps</span><span class="o">.</span><span class="n">elapsed</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[INFO] approx. FPS: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fps</span><span class="o">.</span><span class="n">fps</span><span class="p">()))</span>
    <span class="c1"># Not FPS will be slower due to video writing </span>
    <span class="k">del</span> <span class="n">fvs</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="n">record_FLIRcam</span><span class="p">(</span><span class="n">mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Show-result-video">Show result video<a class="anchor-link" href="#Show-result-video">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">moviepy.editor</span> <span class="k">as</span> <span class="nn">mvp</span>
<span class="n">mvp</span><span class="o">.</span><span class="n">ipython_display</span><span class="p">(</span><span class="s1">&#39;out.mp4&#39;</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
 

